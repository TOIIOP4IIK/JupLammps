# LAMMPS Input File for Grain Boundaries "Ti":

variable lattype string  "hcp"
variable latparam equal  2.92
variable potfile string  'library.meam Co Ti CoTi.meam'
variable METALL string   "Ti"
variable ANGLE  index    150.3
variable DATA_DIR string "DumpVFE"
#variable DeleteAtom string "5429 7540 16357 18168 19200"
variable DeleteAtom index 10574
# ---------- Initialize Simulation --------------------- 
clear 
units metal 
dimension 3 
boundary p p p 
atom_style atomic 

# ---------- Create Atomistic Structure --------------------- 
shell cd STR/
read_data ${METALL}_${ANGLE}.lmp
shell cd ../

# ---------- Define Interatomic Potential --------------------- 
pair_style meam
pair_coeff * * Potential/${potfile} ${METALL} 
neighbor  2.0 bin
neigh_modify delay 10 check yes 
#---------------------------Settings----------------------------
compute csym all centro/atom 12
compute eng all pe/atom 
compute eatoms all reduce sum c_eng

shell mkdir ${DATA_DIR}
shell cd    ${DATA_DIR}
# ---------- Displace atoms and delete overlapping atoms --------------------- 
reset_timestep	0

thermo 10
thermo_style custom step pe lx ly lz press pxx pyy pzz c_eatoms 

dump 1 all custom 400 dump.relax.1.* id type xs ys zs c_csym c_eng 

min_style cg
minimize 1e-25 1e-25 5000 10000

run 0
undump 1

#variable N equal count(all), counts the total number of atoms in the cell
#the total number of atoms is stored to the variable N

variable N equal count(all)
variable No equal $N

#variable Ei equal "c_eatoms" computes the initial energy of the cell system before the vacancy
#E is needed to store the initial energy of the system to the variable Ei

variable E equal "c_eatoms"
variable Ei equal $E

#---------------------------------------------------------------
variable r2 equal sqrt(${latparam}^2+${latparam}^2)/4
#r2 is the radius of the copper atom

#region select is a region defined so that all atoms within this region are removed
#region select sphere 54.2446 47.7525 3.95939 ${r2} units box
group DEL_ATOM id ${DeleteAtom}
delete_atoms group DEL_ATOM compress yes
#---------------------------------------------------------------------
reset_timestep	0
fix 1 all box/relax y 0 vmax 0.001
thermo 10
thermo_style custom step pe lx ly lz press pxx pyy pzz c_eatoms 

dump 1 all custom 400 dump.relax.2.* id type xs ys zs c_csym c_eng 

min_style cg
minimize 1e-25 1e-25 5000 10000

#variable Ef equal "c_eatoms" computes the final energy of the cell system after the vacancy
#The final energy is stored to the variable Ef 

variable Ef equal "c_eatoms"
variable Ev equal (${Ef}-((${No}-1)/${No})*${Ei})

#---------------------------------------------

######################################
# SIMULATION DONE
print "All done"
print "Total number of atoms = ${No}"
print "Initial energy of atoms = ${Ei}"
print "Final energy of atoms = ${Ef}"
print "Vacancy formation energy = ${Ev}"